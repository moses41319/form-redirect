<script>
  async function main() {
    await liff.init({ liffId: "2007867560-ElN1bVyv" });

    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    const userId = (await liff.getProfile()).userId;

    const urlParams = new URLSearchParams(window.location.search);
    let target = urlParams.get("target");

    if (!target) {
      document.body.innerHTML = "<h3>❌ 缺少 target 參數</h3>";
      return;
    }

    target = target.replace('[[USER_ID]]', encodeURIComponent(userId));

    window.location.href = target;
  }

  main();
</script>
