<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æ­£åœ¨å°å‘è¡¨å–®...</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h3>ğŸ”„ æ­£åœ¨ç‚ºæ‚¨è¼‰å…¥è¡¨å–®...</h3>
  <script>
    async function main() {
      await liff.init({ liffId: "2007867560-ElN1bVyv" });

      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }

      const userId = (await liff.getProfile()).userId;

      // ğŸ” æŸ¥è©¢æœƒå“¡è³‡æ–™ï¼ˆä¾†è‡ªæ‚¨æä¾›çš„ Libraryï¼‰
      const res = await fetch(
        `https://docs.google.com/forms/d/e/1FAIpQLSdz2vdeT-YnMk1YfhDxpgLwJKAOEjbby5po0pRfm1EBUwTpgw/viewform?usp=header`
      );
      const userData = await res.json();

      if (!userData || !userData.success) {
        document.body.innerHTML = "<h3>âŒ æŸ¥ç„¡æœƒå“¡è³‡æ–™ï¼Œè«‹å…ˆå®Œæˆè¨»å†Š</h3>";
        return;
      }

      // ğŸ§© å–å¾— target è¡¨å–®ç¶²å€åƒæ•¸
      const urlParams = new URLSearchParams(window.location.search);
      let target = urlParams.get("target");

      if (!target) {
        document.body.innerHTML = "<h3>âŒ ç¼ºå°‘ target åƒæ•¸</h3>";
        return;
      }

      // ğŸ” æ›¿æ›æ¬„ä½è³‡æ–™ï¼ˆè«‹ä¾å¯¦éš›éœ€è¦å¢åŠ æ›´å¤šæ¬„ä½ï¼‰
      target = target
        .replace('[[USER_ID]]', encodeURIComponent(userId))
        .replace('[[å§“å]]', encodeURIComponent(userData.name))
        .replace('[[æ‰‹æ©Ÿ]]', encodeURIComponent(userData.phone))
        .replace('[[åœ°å€]]', encodeURIComponent(userData.address));

      // â© è·³è½‰åˆ° Google è¡¨å–®
      window.location.href = target;
    }

    main();
  </script>
</body>
</html>
