<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>表單自動帶入中...</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h3>🔄 正在為您載入表單...</h3>
  <script>
    async function main() {
      await liff.init({ liffId: "2007867560-ElN1bVyv" });

      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }

      const profile = await liff.getProfile();
      const userId = profile.userId;

      // ✅ 這裡換成你自己的 Apps Script 查詢網址
      const res = await fetch(`https://script.google.com/macros/library/d/16OgfezeuTXkJqIGM57nUa0wj5Y7ygpxjCmuPaqQcMKWSJuoVGQFHTBI1/18/exec?userId=${userId}`);
      const userData = await res.json();

      if (!userData.success) {
        document.body.innerHTML = "<h3>❌ 查無會員資料，請先註冊</h3>";
        return;
      }

      const params = new URLSearchParams(window.location.search);
      let target = params.get("target");

      if (!target) {
        document.body.innerHTML = "<h3>❌ 缺少 target 參數</h3>";
        return;
      }

      // 自動帶入欄位（可自行擴充）
      target = target
        .replace('[[USER_ID]]', encodeURIComponent(userId))
        .replace('[[姓名]]', encodeURIComponent(userData.name))
        .replace('[[手機]]', encodeURIComponent(userData.phone))
        .replace('[[地址]]', encodeURIComponent(userData.address));

      window.location.href = target;
    }

    main();
  </script>
</body>
</html>
