<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Redirecting...</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        padding-top: 100px;
      }
    </style>
  </head>
  <body>
    <h2>ğŸ” æ­£åœ¨ç‚ºæ‚¨è¼‰å…¥è¡¨å–®...</h2>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
      async function main() {
        try {
          await liff.init({ liffId: "2007867560-ElN1bVyv" });

          if (!liff.isLoggedIn()) {
            liff.login();
            return;
          }

          const userProfile = await liff.getProfile();
          const userId = liff.getContext().userId;

          const targetUrl = new URLSearchParams(window.location.search).get("target");
          if (!targetUrl) {
            document.body.innerHTML = "<p>âŒ æœªæä¾›è¡¨å–®ç¶²å€</p>";
            return;
          }

          const apiUrl =
            "https://script.google.com/macros/s/AKfycbx1BY73Mot0RqLcZif3of3HLnskcbDCcUweQTj7j3yra-Dkz9E-8CSFbVR-qBVd6eDD/exec?userId=" +
            encodeURIComponent(userId);

          const response = await fetch(apiUrl);
          const memberData = await response.json();

          const filledUrl = targetUrl
            .replace("[[USER_ID]]", encodeURIComponent(userId))
            .replace("[[å§“å]]", encodeURIComponent(memberData.å§“å || ""))
            .replace("[[æ‰‹æ©Ÿ]]", encodeURIComponent(memberData.æ‰‹æ©Ÿ || ""))
            .replace("[[åœ°å€]]", encodeURIComponent(memberData.åœ°å€ || ""));

          window.location.href = filledUrl;
        } catch (error) {
          document.body.innerHTML = "<p>ğŸš¨ ç™¼ç”ŸéŒ¯èª¤ï¼š " + error + "</p>";
          console.error(error);
        }
      }

      main();
    </script>
  </body>
</html>
