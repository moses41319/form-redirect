<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è¨‚å–®å®Œæˆ</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
    }
    #orderInfo {
      white-space: pre-wrap;
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
      line-height: 1.8;
    }
  </style>
</head>
<body>
  <h2>ğŸ™ æ„Ÿè¬æ‚¨çš„çµç·£ ğŸ™</h2>
  <div id="orderInfo">è¼‰å…¥ä¸­...</div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbx1BY73Mot0RqLcZif3of3HLnskcbDCcUweQTj7j3yra-Dkz9E-8CSFbVR-qBVd6eDD/exec
"; // â†è«‹æ›¿æ›æˆä½ çš„ Apps Script ç¶²å€

    async function main() {
      await liff.init({ liffId: "2007867560-LKO28Gor" }); // â†è«‹æ›¿æ›æˆä½ çš„ LIFF ID

      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }

      const userId = (await liff.getDecodedIDToken()).sub;

      fetch(`${scriptUrl}?action=lastOrder&userId=${userId}`)
        .then(res => res.json())
        .then(data => {
          const orderInfoDiv = document.getElementById("orderInfo");

          if (!data.success) {
            orderInfoDiv.innerText = "âš ï¸ æŸ¥ç„¡è¨‚å–®è³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
            return;
          }

          const order = data.order;
          let message = `âœ… è¨‚å–®å·²é€å‡ºï¼Œè«‹ä¾ä¸‹åˆ—åŒ¯æ¬¾è³‡è¨Šä»˜æ¬¾ï¼š\n\n`;

          order.items.forEach(item => {
            message += `ğŸ“¦ ${item.name} x${item.qty}\n`;
            message += `ğŸ¦ éŠ€è¡Œï¼š${item.bank}\n`;
            message += `ğŸ‘¤ æˆ¶åï¼š${item.accountName}\n`;
            message += `ğŸ”¢ å¸³è™Ÿï¼š${item.accountNumber}\n\n`;
          });

          message += `ğŸ’° ç¸½é‡‘é¡ï¼š${order.total} å…ƒ`;

          orderInfoDiv.innerText = message;
        })
        .catch(err => {
          document.getElementById("orderInfo").innerText = "âš ï¸ ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
          console.error(err);
        });
    }

    main();
  </script>
</body>
</html>
