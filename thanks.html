<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>è¨‚å–®å®Œæˆ</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; white-space: pre-line; }
    .success { font-size: 1.2em; color: green; }
    .info { margin-top: 1.5em; }
  </style>
</head>
<body>
  <div class="success">âœ… è¨‚å–®å·²é€å‡ºæˆåŠŸ</div>
  <div id="info" class="info">è³‡æ–™è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...</div>

  <script>
    const LIFF_ID = "2007867560-LKO28Gor";
    const GAS_URL = "https://script.google.com/macros/s/AKfycbx1BY73Mot0RqLcZif3of3HLnskcbDCcUweQTj7j3yra-Dkz9E-8CSFbVR-qBVd6eDD/exec";

    async function main() {
      await liff.init({ liffId: LIFF_ID });
      if (!liff.isLoggedIn()) liff.login();

      const profile = await liff.getProfile();
      const userId = profile.userId;

      try {
        // æŸ¥è©¢æœƒå“¡æœ€å¾Œä¸€ç­†è¨‚å–®
        const orderRes = await fetch(`${GAS_URL}?action=lastOrder&userId=${userId}`);
        const orderData = await orderRes.json();

        if (!orderData.success || !orderData.order) {
          document.getElementById("info").innerText = "âŒ æŸ¥ç„¡è¨‚å–®è³‡æ–™ã€‚";
          return;
        }

        const { name, phone, address, total, items } = orderData.order;

        let message = `ğŸ‘¤ å§“åï¼š${name}\nğŸ“± é›»è©±ï¼š${phone}\nğŸ  åœ°å€ï¼š${address}\n\nğŸ§§ çµç·£æ˜ç´°ï¼š\n`;

        items.forEach(item => {
          message += `ğŸ“¦ ${item.name} x${item.qty}\n`;
          message += `ğŸ¦ éŠ€è¡Œï¼š${item.bank || 'æœªå¡«å¯«'}\n`;
          message += `ğŸ‘¤ æˆ¶åï¼š${item.accountName || 'æœªå¡«å¯«'}\n`;
          message += `ğŸ”¢ å¸³è™Ÿï¼š${item.accountNumber || 'æœªå¡«å¯«'}\n\n`;
        });

        message += `ğŸ’° ç¸½é‡‘é¡ï¼š${total} å…ƒ`;

        document.getElementById("info").innerText = message;

      } catch (err) {
        document.getElementById("info").innerText = "âŒ ç³»çµ±éŒ¯èª¤ï¼š" + err.message;
      }
    }

    main();
  </script>
</body>
</html>
